const VALIDATOR={P_INT:{validate:()=>!1,message:e=>e&&(isNaN(e)||parseInt(e)<=0)?"请输入一个正数":""},REGION:{validate:e=>/^(([^0](\d+)|(\d)\s*)\s*,){3}([^0](\d+)|(\d)\s*)\s*$/.test(e),message:()=>"区域格式不正确"},COLOR:{validate:e=>/^#[\dabcdef]{6}$/i.test(e),message:()=>"颜色值格式不正确"}};let mixin_methods={data:function(){return{container:".root-container",device:{width:1080,height:2340},is_pro:!1}},methods:{stopTouchmove:function(e){e.stopPropagation()},isNotEmpty:function(e){return!(null==e||""===e)},getContainer:function(){return document.querySelector(this.container)},trimToEmpty:function(e){return this.isNotEmpty(e)?(""+e).trim():""}},filters:{styleTextColor:function(e){return/^#[\dabcdef]{6}$/i.test(e)?{color:e}:null},toFixed2:function(e){return e&&"number"==typeof e?e.toFixed(2):e||""}}},mixin_common={mixins:[mixin_methods],data:function(){return{configs:{}}},methods:{routerTo:function(e){this.$router.push(e)},saveConfigs:function(){this.doSaveConfigs()},loadConfigs:function(){$app.invoke("loadConfigs",{},(e=>{Object.keys(this.configs).forEach((t=>{this.$set(this.configs,t,e[t])})),this.device.width=e.device_width,this.device.height=e.device_height,this.is_pro=e.is_pro,this.onConfigLoad(e)}))},onConfigLoad:function(e){},onSaveConfig:function(){},doSaveConfigs:function(e){console.log("执行保存配置");let t=this.filterErrorFields(this.configs);e&&e.length>0&&e.forEach((e=>{t[e]=""})),$app.invoke("saveConfigs",t)},filterErrorFields:function(e){let t={};Object.assign(t,e);let i=Object.keys(this.validationError);return i&&i.length>0&&i.forEach((e=>{this.isNotEmpty(this.validationError[e])&&(t[e]="")})),t}},computed:{validationError:function(){let e={};return this.isNotEmpty(this.validations)&&Object.keys(this.validations).forEach((t=>{let{[t]:i}=this.configs,{[t]:n}=this.validations;this.isNotEmpty(i)&&!n.validate(i)?e[t]=n.message(i):!this.isNotEmpty(i)&&n.required?e[t]="此项必填":e[t]=""})),e}},mounted(){this.loadConfigs()},destroyed(){console.log("保存当前界面配置"),this.saveConfigs()}};Vue.component("color-input-field",((e,t)=>{e({props:{value:String,label:String,errorMessage:String,placeholder:{type:String,default:"颜色值 #FFFFFF"},labelWidth:String|Number},model:{prop:"value",event:"change"},mixins:[mixin_methods],data(){return{innerValue:this.value}},watch:{innerValue:function(e){this.isNotEmpty(this.colorTextErrorMessage)||this.$emit("change",e)},value:function(e){this.innerValue=e}},computed:{colorTextErrorMessage:function(){return this.errorMessage?this.errorMessage:/^#[\dabcdef]{6}$/i.test(this.innerValue)?"":"颜色值不正确"}},template:'<van-field\n      :label="label" input-align="right" :error-message="colorTextErrorMessage" error-message-align="right" :label-width="labelWidth">\n      <input slot="input" v-model="innerValue" type="text" :placeholder="placeholder" class="van-field__control van-field__control--right"\n      :style="innerValue | styleTextColor" />\n    </van-field>'})})),Vue.component("color-slider",(function(e,t){e({mixins:[mixin_methods],props:["value"],model:{prop:"value",event:"color-change"},data:function(){return{R:0,G:0,B:0}},methods:{resolveDetailInfo:function(){if(/^#[\dabcdef]{6}$/i.test(this.value)){let e=parseInt(this.value.substring(1),16);this.R=e>>16&255,this.G=e>>8&255,this.B=255&e}}},computed:{colorText:function(){let e=(this.R<<16|this.G<<8|this.B).toString(16);return"#"+new Array(7-e.length).join(0)+e}},watch:{colorText:function(e){this.$emit("color-change",e)},value:function(e){this.resolveDetailInfo()}},mounted(){this.resolveDetailInfo()},template:'<div style="padding: 1rem 2rem;">\n      <van-row style="margin: 0.5rem 0">\n        <van-col><span class="simple-span" :style="colorText | styleTextColor">颜色值: {{colorText}}</span></van-col>\n      </van-row>\n      <van-row style="margin: 1.5rem 0 2rem 0">\n        <van-col :span="24">\n          <van-slider v-model="R" :min="0" :max="255" :active-color="\'#\' + R.toString(16) + \'0000\'">\n            <template #button>\n              <div class="custom-slide-button">R:{{ R }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n      <van-row style="margin: 2rem 0">\n        <van-col :span="24">\n          <van-slider v-model="G" :min="0" :max="255" :active-color="\'#00\' + G.toString(16) + \'00\'">\n            <template #button>\n              <div class="custom-slide-button">G:{{ G }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n      <van-row style="margin: 2rem 0">\n        <van-col :span="24">\n          <van-slider v-model="B" :min="0" :max="255" :active-color="\'#0000\' + B.toString(16)">\n            <template #button>\n              <div class="custom-slide-button">B:{{ B }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n    </div>'})})),Vue.component("swipe-color-input-field",(function(e,t){e({mixins:[mixin_methods],props:["value","label","errorMessage","placeholder","labelWidth"],model:{prop:"value",event:"change"},mixins:[mixin_methods],data(){return{innerValue:this.value,showColorSlider:!1}},watch:{innerValue:function(e){this.$emit("change",e)},value:function(e){this.innerValue=e}},template:'<div>\n    <van-swipe-cell stop-propagation>\n      <color-input-field :error-message="errorMessage" v-model="innerValue" :label="label" :label-width="labelWidth" :placeholder="placeholder" />\n      <template #right>\n        <van-button square type="primary" text="滑动输入" @click="showColorSlider=true" />\n      </template>\n    </van-swipe-cell>\n    <van-popup v-model="showColorSlider" position="bottom" :style="{ height: \'30%\' }" :get-container="getContainer">\n      <color-slider v-model="innerValue"/>\n    </van-popup>\n    </div>'})})),Vue.component("region-slider",(function(e,t){e({mixins:[mixin_methods],props:["device_height","device_width","max_height","max_width","value","positionOnly"],model:{prop:"value",event:"region-change"},data:function(){return{x:0,y:0,width:0,height:0}},methods:{resolveDetailInfo:function(){if(this.positionOnly){if(/^(\d+)\s*,(\d+)\s*$/.test(this.value)){let e=/^(\d+)\s*,(\d+)\s*$/.exec(this.value);this.x=parseInt(e[1]),this.y=parseInt(e[2])}}else if(/^(\d+)\s*,(\d+)\s*,(\d+)\s*,(\d+)\s*$/.test(this.value)){let e=/^(\d+)\s*,(\d+)\s*,(\d+)\s*,(\d+)\s*$/.exec(this.value);this.x=parseInt(e[1]),this.y=parseInt(e[2]),this.width=parseInt(e[3]),this.height=parseInt(e[4])}}},computed:{regionText:function(){return this.x+","+this.y+(this.positionOnly?"":","+this.width+","+this.height)}},watch:{regionText:function(e){this.$emit("region-change",e)},value:function(e){this.resolveDetailInfo()}},mounted(){this.resolveDetailInfo()},template:'<div style="padding: 1rem 2rem;">\n      <van-row style="margin: 0.5rem 0">\n        <van-col><span class="simple-span">区域数据: {{regionText}}</span></van-col>\n      </van-row>\n      <van-row style="margin: 1.5rem 0 2rem 0">\n        <van-col :span="24">\n          <van-slider v-model="x" :min="0" :max="device_width || device.width" >\n            <template #button>\n              <div class="custom-slide-button">x:{{ x }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n      <van-row style="margin: 2rem 0">\n        <van-col :span="24">\n          <van-slider v-model="y" :min="0" :max="device_height || device.height" >\n            <template #button>\n              <div class="custom-slide-button">y:{{ y }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n      <van-row style="margin: 2rem 0" v-if="!positionOnly">\n        <van-col :span="24">\n          <van-slider v-model="width" :min="0" :max="max_width || device_width || device.width" >\n            <template #button>\n              <div class="custom-slide-button">w:{{ width }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n      <van-row style="margin: 2rem 0" v-if="!positionOnly">\n        <van-col :span="24">\n          <van-slider v-model="height" :min="0" :max="max_height || device_height || device.height" >\n            <template #button>\n              <div class="custom-slide-button">h:{{ height }}</div>\n            </template>\n          </van-slider>\n        </van-col>\n      </van-row>\n    </div>'})})),Vue.component("region-input-field",(function(e,t){e({mixins:[mixin_methods],props:{value:String|Array,arrayValue:{type:Boolean,default:!1},label:String,labelWidth:String|Number,deviceWidth:Number,deviceHeight:Number,maxWidth:Number,maxHeight:Number,errorMessage:String},model:{prop:"value",event:"change"},data:function(){return{innerValue:(()=>this.arrayValue?this.value&&this.value.length>=4?this.value[0]+","+this.value[1]+","+this.value[2]+","+this.value[3]:"":this.value)(),showRegionSlider:!1}},watch:{innerValue:function(e){/^(\d+,){3}\d+$/.test(this.innerValue)&&(this.arrayValue&&this.isNotEmpty(e)?this.$emit("change",e.split(",").map((e=>parseInt(e)))):this.$emit("change",e))},value:function(e){this.arrayValue?this.value&&this.value.length>=4&&(this.innerValue=this.value[0]+","+this.value[1]+","+this.value[2]+","+this.value[3]):this.innerValue=e}},computed:{positionErrorMessage:function(){return this.isNotEmpty(this.errorMessage)?this.errorMessage:/^(\d+,){3}\d+$/.test(this.innerValue)?"":"区域值不正确"}},template:'<div>\n      <van-swipe-cell stop-propagation>\n        <van-field :error-message="positionErrorMessage" error-message-align="right" v-model="innerValue" :label="label"\n         :label-width="labelWidth" type="text" placeholder="请输入校验区域" input-align="right" />\n        <template #right>\n          <van-button square type="primary" text="滑动输入" @click="showRegionSlider=true" style="height: 100%" />\n        </template>\n      </van-swipe-cell>\n      <van-popup v-model="showRegionSlider" position="bottom" :style="{ height: \'30%\' }" :get-container="getContainer">\n        <region-slider :device_width="deviceWidth" :device_height="deviceHeight"\n         :max_width="maxWidth" :max_height="maxHeight" v-model="innerValue"/>\n      </van-popup>\n    </div>'})})),Vue.component("position-input-field",(e=>{e({mixins:[mixin_methods],props:{value:String|Object,stringValue:{type:Boolean,default:!1},deviceWidth:Number,deviceHeight:Number,errorMessage:String,labelWidth:String|Number,label:String,placeholder:{type:String,default:"输入坐标位置x,y"}},model:{prop:"value",event:"change"},data:function(){return{showRegionSlider:!1,innerValue:(()=>this.stringValue?this.value:void 0!==this.value&&null!==this.value?this.trimToEmpty(this.value.x)+","+this.trimToEmpty(this.value.y):"")()}},watch:{innerValue:function(e){if(!this.isNotEmpty(this.positionErrorMessage))if(!this.stringValue&&this.isNotEmpty(e)){let t=e.split(",");t.length>1&&this.$emit("change",{x:parseInt(t[0]),y:parseInt(t[1])})}else this.$emit("change",e)},value:function(e){this.stringValue?this.innerValue=e:void 0!==this.value&&null!==this.value&&(this.innerValue=this.trimToEmpty(this.value.x)+","+this.trimToEmpty(this.value.y))}},computed:{positionErrorMessage:function(){return this.errorMessage?this.errorMessage:/^\d+,\d+$/i.test(this.innerValue)?"":"位置信息不正确"}},template:'<div>\n      <van-swipe-cell stop-propagation>\n        <van-field :error-message="positionErrorMessage" error-message-align="right" v-model="innerValue" :label="label"\n         :label-width="labelWidth" type="text" placeholder="placeholder" input-align="right" />\n        <template #right>\n          <van-button square type="primary" text="滑动输入" @click="showRegionSlider=true" />\n        </template>\n      </van-swipe-cell>\n      <van-popup v-model="showRegionSlider" position="bottom" :style="{ height: \'30%\' }" :get-container="getContainer">\n        <region-slider :device_width="deviceWidth" :device_height="deviceHeight"\n        :position-only="true" v-model="innerValue"/>\n      </van-popup>\n      </div>'})})),Vue.component("installed-package-selector",(function(e,t){e({mixins:[mixin_methods],props:{addedPackageNames:{type:Array,default:()=>[]}},data:()=>({installedPackages:[{packageName:"com.tony.test",appName:"testApp"}],showPackageSelect:!1,onLoading:!0,canReadPackage:!1,readPackages:null,searchString:""}),methods:{doLoadInstalledPackages:function(){this.canReadPackage&&null!==this.readPackages?(console.log("added pacakges: "+JSON.stringify(this.addedPackageNames)),console.log("all pacakges: "+JSON.stringify(this.readPackages)),this.installedPackages=this.readPackages.filter((e=>this.addedPackageNames.indexOf(e.packageName)<0))):this.installedPackages=[],this.onLoading=!1},loadInstalledPackages:function(){this.showPackageSelect=!0,this.onLoading=!0;let e=this;null===e.readPackages?setTimeout((function(){$app.invoke("loadInstalledPackages",{},(t=>{t&&t.length>0?(e.readPackages=t.sort(((e,t)=>String.prototype.localeCompare?e.appName.localeCompare(t.appName):e.appName>t.appName?1:e.appName===t.appName?0:-1)),e.canReadPackage=!0):e.canReadPackage=!1,e.doLoadInstalledPackages()}))}),350):setTimeout((function(){e.doLoadInstalledPackages()}),350)},selectPackage:function(e){this.$emit("value-change",e),this.showPackageSelect=!1},doSearch:function(e){this.searchString=e},cancelSearch:function(){this.searchString=""}},computed:{filteredPackages:function(){return this.isNotEmpty(this.searchString)?this.installedPackages.filter((e=>e.appName.indexOf(this.searchString)>-1)):this.installedPackages}},template:'<div>\n      <van-row type="flex" justify="center" style="margin-bottom: 0.5rem">\n        <van-col>\n          新增应用白名单\n          <van-button style="margin-left: 0.4rem" plain hairline type="primary" size="mini" @click="loadInstalledPackages">从已安装的列表中选择</van-button>\n        </van-col>\n      </van-row>\n      <van-popup v-model="showPackageSelect" position="bottom" :style="{ height: \'75%\' }" :get-container="getContainer">\n        <van-search v-model="searchString" show-action @search="doSearch" @cancel="cancelSearch" placeholder="请输入搜索关键词" />\n        <van-row v-if="onLoading || !installedPackages || installedPackages.length === 0" type="flex" justify="center" style="margin-top: 8rem;">\n          <van-col v-if="onLoading"><van-loading size="3rem" /></van-col>\n          <template v-else-if="!installedPackages || installedPackages.length === 0">\n            <van-col :style="{ margin: \'2rem\'}" class="van-cell" v-if="!canReadPackage">无法读取应用列表，请确认是否给与了AutoJS读取应用列表的权限</van-col>\n            <van-col :style="{ margin: \'2rem\'}" class="van-cell" v-else>已安装应用已经全部加入到白名单中了，你可真行</van-col>\n          </template>\n        </van-row>\n        <van-row v-else-if="filteredPackages.length === 0" type="flex" justify="center" style="margin-top: 8rem;">\n          <van-col :style="{ margin: \'2rem\'}" class="van-cell">未找到匹配的应用</van-col>\n        </van-row>\n        <van-cell v-if="!onLoading" v-for="package in filteredPackages" :key="package.packageName" :title="package.appName" :label="package.packageName" @click="selectPackage(package)"></van-cell>\n      </van-popup>\n    </div>'})})),Vue.component("number-field",(e=>{e({mixins:[mixin_methods],props:["value","label","labelWidth","errorMessage","placeholder"],model:{prop:"value",event:"change"},data:function(){return{innerValue:(()=>this.isNotEmpty(this.value)?("string"==typeof v&&this.$emit("change",parseFloat(this.value)),parseFloat(this.value)):null)()}},watch:{innerValue:function(e){this.isNotEmpty(e)?this.$emit("change",parseFloat(e)):this.$emit("change","")},value:function(e){this.isNotEmpty(e)?(this.innerValue=parseFloat(e),"string"==typeof e&&this.$emit("change",this.innerValue)):this.innerValue=""}},template:'\n      <van-field\n        v-model="innerValue" :label="label" :label-width="labelWidth" type="number" :error-message="errorMessage" error-message-align="right" :placeholder="placeholder" input-align="right">\n        <template #right-icon><slot name="right-icon"></slot></template>\n      </van-field>\n      '})})),Vue.component("tip-block",(e=>{e({mixins:[mixin_methods],props:{tipFontSize:{type:String,default:"0.7rem"}},template:'<van-row>\n      <van-col :span="22" :offset="1">\n        <span :style="\'color: gray;font-size: \' + tipFontSize"><slot></slot></span>\n      </van-col>\n    </van-row>'})})),Vue.component("switch-cell",(e=>{e({mixins:[mixin_methods],props:{switchSize:{type:String,default:"1.24rem"},value:Boolean,title:String,label:String,titleStyle:String},model:{prop:"value",event:"change"},data:function(){return{innerValue:this.value}},watch:{innerValue:function(e){this.$emit("change",e)},value:function(e){this.innerValue=e}},template:'\n    <van-cell center :title="title" :label="label" :title-style="titleStyle">\n      <van-switch v-model="innerValue" :size="switchSize" />\n    </van-cell>\n    '})}));const FileSelector={mixins:[mixin_common],name:"FileSelector",props:{title:"",initSelectPath:"",value:Boolean,logFileMatcher:{type:Function,default:e=>!0}},model:{prop:"value",event:"select-change"},data(){return{showFileSelectDialog:this.value,currentSelectPath:this.initSelectPath,readFilePath:"",files:[{name:"..",type:"parent"},{name:"logs/",type:"dir",isDir:!0},{name:"脚本/",type:"dir",isDir:!0},{name:"logs/",type:"dir",isDir:!0},{name:"脚本/",type:"dir",isDir:!0},{name:"logs/",type:"dir",isDir:!0},{name:"脚本/",type:"dir",isDir:!0},{name:"logs/",type:"dir",isDir:!0},{name:"脚本/",type:"dir",isDir:!0},{name:"logs/",type:"dir",isDir:!0},{name:"脚本/",type:"dir",isDir:!0},{name:"login.log",type:"log",fileSize:123339},{name:"log.txt",type:"txt",fileSize:111},{name:"data",type:"unknown",fileSize:123339123339}]}},filters:{fileSizeStr:e=>e?e<1024?e+" B":e<1048576?(e/1024).toFixed(2)+" KB":e<1073741824?(e/1024/1024).toFixed(2)+" MB":(e/1024/1024/1024).toFixed(2)+" GB":"0 B"},watch:{value:function(){this.showFileSelectDialog=this.value},showFileSelectDialog:function(e){this.$emit("select-change",e)}},methods:{listFiles:function(e){$nativeApi.request("listLogFiles",{filePath:e||this.currentSelectPath,logFileMatcher:this.logFileMatcher}).then((({fileResult:e})=>{e.error?$app.invoke("toastLog",{message:e.error}):(this.files=[{name:"..",type:"parent"}].concat(e.resultList||[]),this.currentSelectPath=e.path)}))},selectFile:function(e){let t=this.currentSelectPath+"/"+e.name;if(e.isDir)this.listFiles(t);else{if(".."===e.name)return void this.listFiles(this.currentSelectPath.substring(0,this.currentSelectPath.lastIndexOf("/")));this.$dialog.confirm({message:"是否加载该文件？"}).then((()=>{console.log("选择目标文件："+t),this.readFilePath=t,this.showFileSelectDialog=!1,this.$emit("file-selected",{filePath:this.readFilePath})})).catch((()=>{}))}}},mounted(){this.listFiles()},template:'\n  <van-dialog v-model="showFileSelectDialog" :title="title" :show-confirm-button="false" close-on-click-overlay\n    get-container="getContainer">\n    <div style="width: 100%;height: 400px;overflow: scroll;">\n      <van-cell-group>\n        <van-cell v-for="file in files" class="file-cell" @click="selectFile(file)">\n          <template #title>\n            <div class="van-cell__title file-container">\n              <img v-if="file.type===\'parent\'" class="up-dir">\n              <img v-else-if="file.type===\'dir\'" class="folder">\n              <img v-else-if="file.type===\'log\' || file.type===\'txt\'" class="log">\n              <img v-else class="unknown">\n              <span>{{file.name}}</span>\n              <span v-if="file.type !== \'dir\' && file.type !== \'parent\'" class="file-size">{{file.fileSize | fileSizeStr}}</span>\n            </div>\n          </template>\n        </van-cell>\n      </van-cell-group>\n    </div>\n  </van-dialog>\n  '};function formatDate(e,t){void 0===t&&(t="yyyy-MM-dd HH:mm:ss");var i={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours()%12==0?12:e.getHours()%12,"H+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),S:e.getMilliseconds()};let n;for(var a in/(y+)/.test(t)&&(n=/(y+)/.exec(t),t=t.replace(n[1],(e.getFullYear()+"").substring(4-n[1].length))),/(E+)/.test(t)&&(n=/(E+)/.exec(t),t=t.replace(n[1],(n[1].length>1?n[1].length>2?"星期":"周":"")+{0:"日",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六"}[e.getDay()+""])),i)new RegExp("("+a+")").test(t)&&(n=new RegExp("("+a+")").exec(t),t=t.replace(n[1],1===n[1].length?i[a]:("00"+i[a]).substring((""+i[a]).length)));return t}Vue.component("base64-image-viewer",(e=>{e({mixins:[mixin_methods],components:{FileSelector},props:{value:String,title:String,titleStyle:String},model:{prop:"value",event:"change"},data:function(){return{innerValue:this.value,showBase64Inputer:!1,showBase64Selector:!1}},computed:{base64Data:function(){return this.innerValue?"data:image/png;base64,"+this.innerValue:null}},watch:{innerValue:function(e){this.$emit("change",e)},value:function(e){this.innerValue=e}},methods:{handleFileSelect:function({filePath:e}){console.log("准备加载文件内容："+e),$nativeApi.request("loadFileContent",{filePath:e}).then((({fileContent:e})=>{this.innerValue=e}))}},template:'\n    <div>\n      <van-swipe-cell stop-propagation>\n        <div class="base64-viewer">\n          <label>{{title}}:</label>\n          <img :src="base64Data" class="base64-img"/>\n        </div>\n        <template #right>\n          <van-button square type="primary" text="加载文件" @click="showBase64Selector=true" />\n          <van-button square type="primary" text="修改Base64" @click="showBase64Inputer=true" />\n        </template>\n      </van-swipe-cell>\n      <file-selector v-model="showBase64Selector" @file-selected="handleFileSelect" />\n      <van-popup v-model="showBase64Inputer" position="bottom" :style="{ height: \'30%\', alignItems: \'center\' }" :get-container="getContainer">\n        <tip-block>左滑可清空数据</tip-block>\n        <van-swipe-cell stop-propagation style="width:100%">\n          <van-field v-model="innerValue" label="图片base64" type="textarea" placeholder="请输入base64" input-align="right" rows="6" />\n          <template #right>\n            <van-button square type="primary" text="清空" @click="innerValue=\'\'" style="height:100%" />\n          </template>\n        </van-swipe-cell>\n      </van-popup>\n    </div>\n    '})})),API={post:function(e,t){return axios.post(e,qs.stringify(t)).then((e=>Promise.resolve(e.data))).catch((e=>Promise.reject(e)))},get:function(e,t){return axios.get(e,t).then((e=>Promise.resolve(e.data))).catch((e=>Promise.reject(e)))}};